function checkLocalFile(e){let a=new File(e.type);return a.mkdirs(),Utility.check(new File(a,e.getBasename()+".jar"),new File(a,e.getBasename()+".sha1"))}function check(e){logger.info('Verifying "'+e.id+'" version '+e.version);let a=loader.cli.hasOption("u"),l=loader.cli.hasOption("x"),n=!1;checkLocalFile(e)||(logger.info('"'+e.id+":"+e.version+'" is corrupted. Start downloading...'),n=!0);let o=loader.repo.fetchPackage(e.id);if(o.channels.containsKey(e.channel)){let i=o.channels[e.channel],t=i[i.size()-1];if(!a&&!e.version.equals(t)||a&&!i.contains(e.version)&&!l){if(e.type.equals(Config.Package.TYPE_PLUGIN)){let a=new File(e.type);new File(a,e.getBasename()+".jar").renameTo(new File(a,e.getBasename()+".jar.bak"))}e.version=t,n=!0}n&&(downloadFile(e,o),checkLocalFile(e)||logger.warning('The local file "'+e.id+'" is still corrupted, please check the network.'))}else logger.error('Invalid update channel "'+e.channel+'" for Package "'+e.name+'"')}function downloadFile(e,a){let l=new File(e.type);l.mkdirs();let n=e.version,o=loader.repo.getJarUrl(e,a);if(o.equals(""))logger.error('Cannot download package "'+e.id+'".');else{down(o,new File(l,e.getName()+"-"+n+".jar")),down(o+".sha1",new File(l,e.getName()+"-"+n+".sha1"));let i=loader.repo.getMetadataUrl(e,a);i.equals("")||down(i,new File(l,e.getName()+"-"+n+".metadata"))}}importPackage(java.io),importPackage(java.lang),importPackage(java.math),importPackage(org.itxtech.mcl),importPackage(org.itxtech.mcl.component),importPackage(org.apache.commons.cli),loader.options.addOption(Option.builder("u").desc("Disable auto update").longOpt("disable-update").build()),loader.options.addOption(Option.builder("x").desc("Force download specified version").longOpt("force-version").build()),phase.load=(()=>{let e=loader.config.packages;for(let a in e)check(e[a])});let emptyString=function(){let e="",a=1024;for(;a-- >0;)e+=" ";return e}();function alignRight(e,a){let l=Math.max(e.length,a.length);return emptyString.substring(0,l-e.length)+e}function buildDownloadBar(e,a){let l=Math.floor(a/e*30),n="[";for(let e=0;e<l;e++)n+="=";if(l<30){n+=">";for(let e=l;e<30;e++)n+=" "}return n+"]"}function down(e,a){let l=a.name;var n=0;let o="";loader.downloader.download(e,a,(e,a)=>{o=Utility.humanReadableFileSize(e);var i=Utility.humanReadableFileSize(a);let t=" Downloading "+l+" "+buildDownloadBar(e,a)+" "+alignRight(i,o)+" / "+o+" ("+Math.floor(1e3*a/e)/10+"%)   \r";logger.print(t),n=t.length}),logger.print(emptyString.substr(0,n)+"\r"),logger.println(" Downloading "+l+" "+buildDownloadBar(1,1)+" "+o)}